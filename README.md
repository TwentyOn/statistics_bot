# Телеграм-бот выдачи статистики из Яндекс.Метрики

Функционал: бот принимает на вход следующие данные:
- url-адреса которые размещены в рекламной кампании, 
разделенные знаком пробела, табуляцией или переносом строки (не более 20)
- период формирования отчета в формате DD.MM.YYYY-DD.MM.YYYY

Результатом работы бота является xlsx-файл со стастикой трафика по каждому из 
принятых url-адресов. Файл загружается в удалённое хранилище

Структура проекта:
- bot - бизнес-логика бота (взаимодействие с telegram-API)
- database - определение параметров подключения к БД и моделей (структуры) таблиц
- utils - модули для подключения к API Яндекс.Метрики, логирования, 
обработки входных данных, загрузки результатов в хранилище (MinIo)

# Необходимые компоненты:
 - python 3.11^
 - PostgreSQL 
 - Виртуальное окружение
 - файл окружения с наименованием .env

# Требования к переменным окружения
Переменные окружения подгружаются из файла .env с помощью библиотеки dotenv.
В файле окружения должны находиться следующие переменные:
- переменные внешних интеграции:
  - TG_TOKEN - токен телеграм-бота
  - YM_TOKEN - токен API-отчетов Яндекс.Метрики
- переменные базы данных:
  - DB_NAME - имя БД
  - DB_USER - имя пользователя БД
  - DB_PASSWORD - пароль
  - DB_HOST - адрес сервера БД
  - DB_PORT - порт БД
- переменные S3-хранилища (MinIo)
  - S3_ENDPOINT_URL - основной адрес хранилища 
  - S3_OUTER_ENDPOINT_URL - внешний адрес хранилища 
  - S3_ACCESS_KEY - логин от хранилища
  - S3_SECRET_KEY - пароль от хранилища
  - S3_BUCKET_NAME - имя корзины с которой будет работать API 
  - S3_SECURE - параметр безопасности
  

# Создание виртуального окружения
windows power shell:
- Создание: ```python -m venv <имя_окружения>```
- Запуск: ```<имя_окружения>/Scripts/activate```

# Установка необходимых библиотек
Необходиые библиотеки представлены в файле requirements.txt. 
Для установки требуется выполнить команду (winwows power shell): ```pip install -r requirements.txt```

# Локальный запуск

Для локальной работы бота достаточно запустить модуль bot/main.py: ```python bot/main.py```

# Docker
Запуск в docker-контейнере

Сборка образа: ```docker build -t <имя_образа>```

Базовый запуск контейнера: ```docker run <имя_образа>```